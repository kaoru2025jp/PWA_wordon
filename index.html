<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>循環パスワードプログラム</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffffff">

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

<style>
body { font-family: sans-serif; padding: 20px; }
#blinkingText { font-size: 22px; font-weight: bold; min-height: 1.5em; margin-top: 10px; }
.calc-box, .pw-box {
  margin-top: 25px;
  padding: 15px;
  border-radius: 8px;
}
.calc-box { background: #f5f5f5; border: 1px solid #aaa; }
.pw-box { background: #fff8d6; border: 1px dashed #555; }
label { display: block; margin-top: 8px; }
.error { color: red; margin-top: 10px; font-weight: bold; }
</style>
<style>
/* 画面拡大用 */
.zoom-wrapper {
  transform-origin: top left;
}
</style>
</head>

<body>
<div id="main"></div>

<script>
// ------------------------------
// テンプレート
// ------------------------------
function template(mode) {
  const label = mode === "forward" ? "次のページへ" : "最初のページへ";
  const action = mode === "forward" ? "goNext()" : "goBack()";

  return `
<h2>循環パスワードページ</h2>

<label>表示する文字:</label>
<input type="text" id="textInput" value="点滅テキスト">

<label>点滅間隔: <span id="intervalValue">500</span> ms</label>
<input type="range" id="intervalSlider" min="100" max="2000" value="500">

<p id="blinkingText"></p>

<div class="calc-box">
  <h3>計算式：S = B - O × T</h3>
  <label>B:</label><input type="number" id="B" value="100">
  <label>O:</label><input type="number" id="O" value="2">
  <label>T:</label><input type="number" id="T" value="10">
  <p>S = <span id="S">0</span></p>
</div>

<div class="pw-box">
  <h3>S の整数部分をパスワードとして入力</h3>
  <input type="number" id="pwInput">
  <button onclick="${action}">${label}</button>
  <p id="pwError" class="error"></p>
</div>
`;
}

// ------------------------------
// ページ制御
// ------------------------------
function loadPage1() {
  main.innerHTML = template("forward");
  setUp();
}

function loadPage2() {
  main.innerHTML = template("back");
  setUp();
}

function goNext() {
  checkPassword(loadPage2);
}

function goBack() {
  checkPassword(loadPage1);
}

function checkPassword(next) {
  const correct = Math.floor(parseFloat(S.textContent));
  if (pwInput.value === String(correct)) {
    next();
  } else {
    pwError.textContent = "パスワードが違います。";
  }
}

// ------------------------------
// 共通処理
// ------------------------------
function setUp() {
  const txt = textInput;
  const blink = blinkingText;
  const slider = intervalSlider;
  let timer;

  function start(ms) {
    clearInterval(timer);
    timer = setInterval(() => {
      blink.style.visibility =
        blink.style.visibility === "hidden" ? "visible" : "hidden";
    }, ms);
  }

  txt.oninput = () => blink.textContent = txt.value;
  slider.oninput = () => {
    intervalValue.textContent = slider.value;
    start(slider.value);
  };

  blink.textContent = txt.value;
  start(slider.value);

  function calc() {
    S.textContent =
      (B.value || 0) - (O.value || 0) * (T.value || 0);
  }

  B.oninput = O.oninput = T.oninput = calc;
  calc();
}

// 起動
loadPage1();
</script>
</body>
</html>
